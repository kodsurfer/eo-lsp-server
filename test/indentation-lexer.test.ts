// SPDX-FileCopyrightText: Copyright (c) 2024-2025 Objectionary.com
// SPDX-License-Identifier: MIT

import { CharStreams, Token } from "antlr4ts";
import { IndentationLexer } from "../src/IndentationLexer";
import { EoLexer } from "../src/parser/EoLexer";

describe("IndentationLexer", () => {
    describe("handleTabs", () => {
        test("emits TAB/UNTAB tokens based on the difference between the current and previous indentation.", () => {
            const input = "  2spaces\n      6spaces\n    4spaces";
            const chrStream = CharStreams.fromString(input);
            const lexer = new IndentationLexer(chrStream);
            const tokens: Token[] = [];
            let token: Token = lexer.nextToken();
            while (token.type !== Token.EOF) {
                tokens.push(token);
                token = lexer.nextToken();
            }
            const tabTokens = tokens.filter(t => t.type === IndentationLexer.TAB);
            const untabTokens = tokens.filter(t => t.type === IndentationLexer.UNTAB);
            expect(tabTokens.length).toBeGreaterThan(0);
            expect(untabTokens.length).toBeGreaterThan(0);
        });
    });
    describe("getters", () => {
        test("get all the values", () => {
            const lexer = new IndentationLexer(CharStreams.fromString(""));
            expect(lexer.channelNames).toEqual(["DEFAULT_TOKEN_CHANNEL", "HIDDEN"]);
            expect(lexer.grammarFileName).toBe("Eo.g4");
            expect(lexer.modeNames).toEqual(["DEFAULT_MODE"]);
            expect(lexer.ruleNames).toEqual([
                "COMMENTARY", "META", "ROOT", "HOME", "STAR", "CONST", "COLON", "ARROW",
                "XI", "PLUS", "MINUS", "QUESTION", "SPACE", "DOT", "LSQ", "RSQ", "LB",
                "RB", "PHI", "RHO", "HASH", "TILDE", "APOSTROPHE", "INDENT", "LINEBREAK",
                "EOL", "BYTE", "EMPTY_BYTES", "LINE_BYTES", "BYTES", "ESCAPE_SEQUENCE",
                "STRING", "ZERO", "INT", "EXPONENT", "FLOAT", "HEX", "NAME", "TEXT_MARK",
                "TEXT"
            ]);
            expect(lexer.serializedATN).toBe("\x03\uC91D\uCABA\u058D\uAFBA\u4F53\u0607\uEA8B\uC241\x02!\u0134\b\x01" +
            "\x04\x02\t\x02\x04\x03\t\x03\x04\x04\t\x04\x04\x05\t\x05\x04\x06\t\x06" +
            "\x04\x07\t\x07\x04\b\t\b\x04\t\t\t\x04\n\t\n\x04\v\t\v\x04\f\t\f\x04\r" +
            "\t\r\x04\x0E\t\x0E\x04\x0F\t\x0F\x04\x10\t\x10\x04\x11\t\x11\x04\x12\t" +
            "\x12\x04\x13\t\x13\x04\x14\t\x14\x04\x15\t\x15\x04\x16\t\x16\x04\x17\t" +
            "\x17\x04\x18\t\x18\x04\x19\t\x19\x04\x1A\t\x1A\x04\x1B\t\x1B\x04\x1C\t" +
            "\x1C\x04\x1D\t\x1D\x04\x1E\t\x1E\x04\x1F\t\x1F\x04 \t \x04!\t!\x04\"\t" +
            "\"\x04#\t#\x04$\t$\x04%\t%\x04&\t&\x04\'\t\'\x04(\t(\x04)\t)\x03\x02\x03" +
            "\x02\x03\x02\x07\x02W\n\x02\f\x02\x0E\x02Z\v\x02\x03\x02\x03\x02\x05\x02" +
            "^\n\x02\x03\x03\x03\x03\x03\x03\x03\x03\x06\x03d\n\x03\r\x03\x0E\x03e" +
            "\x07\x03h\n\x03\f\x03\x0E\x03k\v\x03\x03\x04\x03\x04\x03\x05\x03\x05\x03" +
            "\x05\x03\x06\x03\x06\x03\x07\x03\x07\x03\b\x03\b\x03\t\x03\t\x03\n\x03" +
            "\n\x03\v\x03\v\x03\f\x03\f\x03\r\x03\r\x03\x0E\x03\x0E\x03\x0F\x03\x0F" +
            "\x03\x10\x03\x10\x03\x11\x03\x11\x03\x12\x03\x12\x03\x13\x03\x13\x03\x14" +
            "\x03\x14\x03\x15\x03\x15\x03\x16\x03\x16\x03\x17\x03\x17\x03\x18\x03\x18" +
            "\x03\x19\x03\x19\x03\x19\x03\x1A\x03\x1A\x03\x1A\x05\x1A\x9E\n\x1A\x03" +
            "\x1B\x03\x1B\x07\x1B\xA2\n\x1B\f\x1B\x0E\x1B\xA5\v\x1B\x03\x1C\x03\x1C" +
            "\x03\x1C\x03\x1D\x03\x1D\x03\x1D\x03\x1E\x03\x1E\x03\x1E\x03\x1E\x06\x1E" +
            "\xB1\n\x1E\r\x1E\x0E\x1E\xB2\x03\x1F\x03\x1F\x03\x1F\x03\x1F\x03\x1F\x03" +
            "\x1F\x03\x1F\x03\x1F\x03\x1F\x07\x1F\xBE\n\x1F\f\x1F\x0E\x1F\xC1\v\x1F" +
            "\x05\x1F\xC3\n\x1F\x03 \x03 \x03 \x03 \x05 \xC9\n \x03 \x05 \xCC\n \x03" +
            " \x03 \x03 \x06 \xD1\n \r \x0E \xD2\x03 \x03 \x03 \x05 \xD8\n \x03!\x03" +
            "!\x03!\x07!\xDD\n!\f!\x0E!\xE0\v!\x03!\x03!\x03\"\x03\"\x03#\x03#\x05" +
            "#\xE8\n#\x03#\x03#\x05#\xEC\n#\x03#\x03#\x07#\xF0\n#\f#\x0E#\xF3\v#\x05" +
            "#\xF5\n#\x03$\x03$\x03$\x05$\xFA\n$\x03$\x06$\xFD\n$\r$\x0E$\xFE\x03%" +
            "\x03%\x05%\u0103\n%\x03%\x06%\u0106\n%\r%\x0E%\u0107\x03%\x03%\x06%\u010C" +
            "\n%\r%\x0E%\u010D\x03%\x05%\u0111\n%\x03&\x03&\x03&\x03&\x06&\u0117\n" +
            "&\r&\x0E&\u0118\x03\'\x03\'\x07\'\u011D\n\'\f\'\x0E\'\u0120\v\'\x03(\x03" +
            "(\x03(\x03(\x03)\x03)\x03)\x03)\x05)\u012A\n)\x03)\x03)\x07)\u012E\n)" +
            "\f)\x0E)\u0131\v)\x03)\x03)\x03\u012F\x02\x02*\x03\x02\x03\x05\x02\x04" +
            "\x07\x02\x05\t\x02\x06\v\x02\x07\r\x02\b\x0F\x02\t\x11\x02\n\x13\x02\v" +
            "\x15\x02\f\x17\x02\r\x19\x02\x0E\x1B\x02\x0F\x1D\x02\x10\x1F\x02\x11!" +
            "\x02\x12#\x02\x13%\x02\x14\'\x02\x15)\x02\x16+\x02\x17-\x02\x18/\x02\x19" +
            "1\x02\x023\x02\x025\x02\x1A7\x02\x029\x02\x02;\x02\x02=\x02\x1B?\x02\x02" +
            "A\x02\x1CC\x02\x02E\x02\x1DG\x02\x02I\x02\x1EK\x02\x1FM\x02 O\x02\x02" +
            "Q\x02!\x03\x02\x0F\x04\x02\f\f\x0F\x0F\x05\x02\v\f\x0F\x0F\"\"\x04\x02" +
            "2;CH\n\x02$$))^^ddhhppttvv\x03\x0225\x03\x0229\x06\x02\f\f\x0F\x0F$$^" +
            "^\x03\x023;\x03\x022;\x04\x02GGgg\x05\x022;CHch\x03\x02c|\x03\x02^^\x03" +
            "\x0E\x02\v\x02\f\x02\x0F\x02\x0F\x02\"\x02#\x02)\x02+\x02.\x02.\x020\x02" +
            "0\x02<\x02=\x02A\x02A\x02]\x02]\x02_\x02_\x02}\x02\x7F\x02\uF337\x03\uF337" +
            "\x03\u014D\x02\x03\x03\x02\x02\x02\x02\x05\x03\x02\x02\x02\x02\x07\x03" +
            "\x02\x02\x02\x02\t\x03\x02\x02\x02\x02\v\x03\x02\x02\x02\x02\r\x03\x02" +
            "\x02\x02\x02\x0F\x03\x02\x02\x02\x02\x11\x03\x02\x02\x02\x02\x13\x03\x02" +
            "\x02\x02\x02\x15\x03\x02\x02\x02\x02\x17\x03\x02\x02\x02\x02\x19\x03\x02" +
            "\x02\x02\x02\x1B\x03\x02\x02\x02\x02\x1D\x03\x02\x02\x02\x02\x1F\x03\x02" +
            "\x02\x02\x02!\x03\x02\x02\x02\x02#\x03\x02\x02\x02\x02%\x03\x02\x02\x02" +
            "\x02\'\x03\x02\x02\x02\x02)\x03\x02\x02\x02\x02+\x03\x02\x02\x02\x02-" +
            "\x03\x02\x02\x02\x02/\x03\x02\x02\x02\x025\x03\x02\x02\x02\x02=\x03\x02" +
            "\x02\x02\x02A\x03\x02\x02\x02\x02E\x03\x02\x02\x02\x02I\x03\x02\x02\x02" +
            "\x02K\x03\x02\x02\x02\x02M\x03\x02\x02\x02\x02Q\x03\x02\x02\x02\x03]\x03" +
            "\x02\x02\x02\x05_\x03\x02\x02\x02\x07l\x03\x02\x02\x02\tn\x03\x02\x02" +
            "\x02\vq\x03\x02\x02\x02\rs\x03\x02\x02\x02\x0Fu\x03\x02\x02\x02\x11w\x03" +
            "\x02\x02\x02\x13y\x03\x02\x02\x02\x15{\x03\x02\x02\x02\x17}\x03\x02\x02" +
            "\x02\x19\x7F\x03\x02\x02\x02\x1B\x81\x03\x02\x02\x02\x1D\x83\x03\x02\x02" +
            "\x02\x1F\x85\x03\x02\x02\x02!\x87\x03\x02\x02\x02#\x89\x03\x02\x02\x02" +
            "%\x8B\x03\x02\x02\x02\'\x8D\x03\x02\x02\x02)\x8F\x03\x02\x02\x02+\x91" +
            "\x03\x02\x02\x02-\x93\x03\x02\x02\x02/\x95\x03\x02\x02\x021\x97\x03\x02" +
            "\x02\x023\x9D\x03\x02\x02\x025\x9F\x03\x02\x02\x027\xA6\x03\x02\x02\x02" +
            "9\xA9\x03\x02\x02\x02;\xAC\x03\x02\x02\x02=\xC2\x03\x02\x02\x02?\xD7\x03" +
            "\x02\x02\x02A\xD9\x03\x02\x02\x02C\xE3\x03\x02\x02\x02E\xE7\x03\x02\x02" +
            "\x02G\xF6\x03\x02\x02\x02I\u0102\x03\x02\x02\x02K\u0112\x03\x02\x02\x02" +
            "M\u011A\x03\x02\x02\x02O\u0121\x03\x02\x02\x02Q\u0125\x03\x02\x02\x02" +
            "S^\x05+\x16\x02TX\x05+\x16\x02UW\n\x02\x02\x02VU\x03\x02\x02\x02WZ\x03" +
            "\x02\x02\x02XV\x03\x02\x02\x02XY\x03\x02\x02\x02Y[\x03\x02\x02\x02ZX\x03" +
            "\x02\x02\x02[\\\n\x03\x02\x02\\^\x03\x02\x02\x02]S\x03\x02\x02\x02]T\x03" +
            "\x02\x02\x02^\x04\x03\x02\x02\x02_`\x05\x15\v\x02`i\x05M\'\x02ac\x05\x1B" +
            "\x0E\x02bd\n\x03\x02\x02cb\x03\x02\x02\x02de\x03\x02\x02\x02ec\x03\x02" +
            "\x02\x02ef\x03\x02\x02\x02fh\x03\x02\x02\x02ga\x03\x02\x02\x02hk\x03\x02" +
            "\x02\x02ig\x03\x02\x02\x02ij\x03\x02\x02\x02j\x06\x03\x02\x02\x02ki\x03" +
            "\x02\x02\x02lm\x07S\x02\x02m\b\x03\x02\x02\x02no\x07S\x02\x02op\x07S\x02" +
            "\x02p\n\x03\x02\x02\x02qr\x07,\x02\x02r\f\x03\x02\x02\x02st\x07#\x02\x02" +
            "t\x0E\x03\x02\x02\x02uv\x07<\x02\x02v\x10\x03\x02\x02\x02wx\x07@\x02\x02" +
            "x\x12\x03\x02\x02\x02yz\x07&\x02\x02z\x14\x03\x02\x02\x02{|\x07-\x02\x02" +
            "|\x16\x03\x02\x02\x02}~\x07/\x02\x02~\x18\x03\x02\x02\x02\x7F\x80\x07" +
            "A\x02\x02\x80\x1A\x03\x02\x02\x02\x81\x82\x07\"\x02\x02\x82\x1C\x03\x02" +
            "\x02\x02\x83\x84\x070\x02\x02\x84\x1E\x03\x02\x02\x02\x85\x86\x07]\x02" +
            "\x02\x86 \x03\x02\x02\x02\x87\x88\x07_\x02\x02\x88\"\x03\x02\x02\x02\x89" +
            "\x8A\x07*\x02\x02\x8A$\x03\x02\x02\x02\x8B\x8C\x07+\x02\x02\x8C&\x03\x02" +
            "\x02\x02\x8D\x8E\x07B\x02\x02\x8E(\x03\x02\x02\x02\x8F\x90\x07`\x02\x02" +
            "\x90*\x03\x02\x02\x02\x91\x92\x07%\x02\x02\x92,\x03\x02\x02\x02\x93\x94" +
            "\x07\x80\x02\x02\x94.\x03\x02\x02\x02\x95\x96\x07)\x02\x02\x960\x03\x02" +
            "\x02\x02\x97\x98\x05\x1B\x0E\x02\x98\x99\x05\x1B\x0E\x02\x992\x03\x02" +
            "\x02\x02\x9A\x9E\x07\f\x02\x02\x9B\x9C\x07\x0F\x02\x02\x9C\x9E\x07\f\x02" +
            "\x02\x9D\x9A\x03\x02\x02\x02\x9D\x9B\x03\x02\x02\x02\x9E4\x03\x02\x02" +
            "\x02\x9F\xA3\x053\x1A\x02\xA0\xA2\x051\x19\x02\xA1\xA0\x03\x02\x02\x02" +
            "\xA2\xA5\x03\x02\x02\x02\xA3\xA1\x03\x02\x02\x02\xA3\xA4\x03\x02\x02\x02" +
            "\xA46\x03\x02\x02\x02\xA5\xA3\x03\x02\x02\x02\xA6\xA7\t\x04\x02\x02\xA7" +
            "\xA8\t\x04\x02\x02\xA88\x03\x02\x02\x02\xA9\xAA\x05\x17\f\x02\xAA\xAB" +
            "\x05\x17\f\x02\xAB:\x03\x02\x02\x02\xAC\xB0\x057\x1C\x02\xAD\xAE\x05\x17" +
            "\f\x02\xAE\xAF\x057\x1C\x02\xAF\xB1\x03\x02\x02\x02\xB0\xAD\x03\x02\x02" +
            "\x02\xB1\xB2\x03\x02\x02\x02\xB2\xB0\x03\x02\x02\x02\xB2\xB3\x03\x02\x02" +
            "\x02\xB3<\x03\x02\x02\x02\xB4\xC3\x059\x1D\x02\xB5\xB6\x057\x1C\x02\xB6" +
            "\xB7\x05\x17\f\x02\xB7\xC3\x03\x02\x02\x02\xB8\xBF\x05;\x1E\x02\xB9\xBA" +
            "\x05\x17\f\x02\xBA\xBB\x055\x1B\x02\xBB\xBC\x05;\x1E\x02\xBC\xBE\x03\x02" +
            "\x02\x02\xBD\xB9\x03\x02\x02\x02\xBE\xC1\x03\x02\x02\x02\xBF\xBD\x03\x02" +
            "\x02\x02\xBF\xC0\x03\x02\x02\x02\xC0\xC3\x03\x02\x02\x02\xC1\xBF\x03\x02" +
            "\x02\x02\xC2\xB4\x03\x02\x02\x02\xC2\xB5\x03\x02\x02\x02\xC2\xB8\x03\x02" +
            "\x02\x02\xC3>\x03\x02\x02\x02\xC4\xC5\x07^\x02\x02\xC5\xD8\t\x05\x02\x02" +
            "\xC6\xCB\x07^\x02\x02\xC7\xC9\t\x06\x02\x02\xC8\xC7\x03\x02\x02\x02\xC8" +
            "\xC9\x03\x02\x02\x02\xC9\xCA\x03\x02\x02\x02\xCA\xCC\t\x07\x02\x02\xCB" +
            "\xC8\x03\x02\x02\x02\xCB\xCC\x03\x02\x02\x02\xCC\xCD\x03\x02\x02\x02\xCD" +
            "\xD8\t\x07\x02\x02\xCE\xD0\x07^\x02\x02\xCF\xD1\x07w\x02\x02\xD0\xCF\x03" +
            "\x02\x02\x02\xD1\xD2\x03\x02\x02\x02\xD2\xD0\x03\x02\x02\x02\xD2\xD3\x03" +
            "\x02\x02\x02\xD3\xD4\x03\x02\x02\x02\xD4\xD5\x057\x1C\x02\xD5\xD6\x05" +
            "7\x1C\x02\xD6\xD8\x03\x02\x02\x02\xD7\xC4\x03\x02\x02\x02\xD7\xC6\x03" +
            "\x02\x02\x02\xD7\xCE\x03\x02\x02\x02\xD8@\x03\x02\x02\x02\xD9\xDE\x07" +
            "$\x02\x02\xDA\xDD\n\b\x02\x02\xDB\xDD\x05? \x02\xDC\xDA\x03\x02\x02\x02" +
            "\xDC\xDB\x03\x02\x02\x02\xDD\xE0\x03\x02\x02\x02\xDE\xDC\x03\x02\x02\x02" +
            "\xDE\xDF\x03\x02\x02\x02\xDF\xE1\x03\x02\x02\x02\xE0\xDE\x03\x02\x02\x02" +
            "\xE1\xE2\x07$\x02\x02\xE2B\x03\x02\x02\x02\xE3\xE4\x072\x02\x02\xE4D\x03" +
            "\x02\x02\x02\xE5\xE8\x05\x15\v\x02\xE6\xE8\x05\x17\f\x02\xE7\xE5\x03\x02" +
            "\x02\x02\xE7\xE6\x03\x02\x02\x02\xE7\xE8\x03\x02\x02\x02\xE8\xF4\x03\x02" +
            "\x02\x02\xE9\xF5\x05C\"\x02\xEA\xEC\x05C\"\x02\xEB\xEA\x03\x02\x02\x02" +
            "\xEB\xEC\x03\x02\x02\x02\xEC\xED\x03\x02\x02\x02\xED\xF1\t\t\x02\x02\xEE" +
            "\xF0\t\n\x02\x02\xEF\xEE\x03\x02\x02\x02\xF0\xF3\x03\x02\x02\x02\xF1\xEF" +
            "\x03\x02\x02\x02\xF1\xF2\x03\x02\x02\x02\xF2\xF5\x03\x02\x02\x02\xF3\xF1" +
            "\x03\x02\x02\x02\xF4\xE9\x03\x02\x02\x02\xF4\xEB\x03\x02\x02\x02\xF5F" +
            "\x03\x02\x02\x02\xF6\xF9\t\v\x02\x02\xF7\xFA\x05\x15\v\x02\xF8\xFA\x05" +
            "\x17\f\x02\xF9\xF7\x03\x02\x02\x02\xF9\xF8\x03\x02\x02\x02\xF9\xFA\x03" +
            "\x02\x02\x02\xFA\xFC\x03\x02\x02\x02\xFB\xFD\x042;\x02\xFC\xFB\x03\x02" +
            "\x02\x02\xFD\xFE\x03\x02\x02\x02\xFE\xFC\x03\x02\x02\x02\xFE\xFF\x03\x02" +
            "\x02\x02\xFFH\x03\x02\x02\x02\u0100\u0103\x05\x15\v\x02\u0101\u0103\x05" +
            "\x17\f\x02\u0102\u0100\x03\x02\x02\x02\u0102\u0101\x03\x02\x02\x02\u0102" +
            "\u0103\x03\x02\x02\x02\u0103\u0105\x03\x02\x02\x02\u0104\u0106\t\n\x02" +
            "\x02\u0105\u0104\x03\x02\x02\x02\u0106\u0107\x03\x02\x02\x02\u0107\u0105" +
            "\x03\x02\x02\x02\u0107\u0108\x03\x02\x02\x02\u0108\u0109\x03\x02\x02\x02" +
            "\u0109\u010B\x05\x1D\x0F\x02\u010A\u010C\t\n\x02\x02\u010B\u010A\x03\x02" +
            "\x02\x02\u010C\u010D\x03\x02\x02\x02\u010D\u010B\x03\x02\x02\x02\u010D" +
            "\u010E\x03\x02\x02\x02\u010E\u0110\x03\x02\x02\x02\u010F\u0111\x05G$\x02" +
            "\u0110\u010F\x03\x02\x02\x02\u0110\u0111\x03\x02\x02\x02\u0111J\x03\x02" +
            "\x02\x02\u0112\u0113\x072\x02\x02\u0113\u0114\x07z\x02\x02\u0114\u0116" +
            "\x03\x02\x02\x02\u0115\u0117\t\f\x02\x02\u0116\u0115\x03\x02\x02\x02\u0117" +
            "\u0118\x03\x02\x02\x02\u0118\u0116\x03\x02\x02\x02\u0118\u0119\x03\x02" +
            "\x02\x02\u0119L\x03\x02\x02\x02\u011A\u011E\t\r\x02\x02\u011B\u011D\n" +
            "\x0F\x02\x02\u011C\u011B\x03\x02\x02\x02\u011D\u0120\x03\x02\x02\x02\u011E" +
            "\u011C\x03\x02\x02\x02\u011E\u011F\x03\x02\x02\x02\u011FN\x03\x02\x02" +
            "\x02\u0120\u011E\x03\x02\x02\x02\u0121\u0122\x07$\x02\x02\u0122\u0123" +
            "\x07$\x02\x02\u0123\u0124\x07$\x02\x02\u0124P\x03\x02\x02\x02\u0125\u0129" +
            "\x05O(\x02\u0126\u012A\x07\f\x02\x02\u0127\u0128\x07\x0F\x02\x02\u0128" +
            "\u012A\x07\f\x02\x02\u0129\u0126\x03\x02\x02\x02\u0129\u0127\x03\x02\x02" +
            "\x02\u012A\u012F\x03\x02\x02\x02\u012B\u012E\n\x0E\x02\x02\u012C\u012E" +
            "\x05? \x02\u012D\u012B\x03\x02\x02\x02\u012D\u012C\x03\x02\x02\x02\u012E" +
            "\u0131\x03\x02\x02\x02\u012F\u0130\x03\x02\x02\x02\u012F\u012D\x03\x02" +
            "\x02\x02\u0130\u0132\x03\x02\x02\x02\u0131\u012F\x03\x02\x02\x02\u0132" +
            "\u0133\x05O(\x02\u0133R\x03\x02\x02\x02!\x02X]ei\x9D\xA3\xB2\xBF\xC2\xC8" +
            "\xCB\xD2\xD7\xDC\xDE\xE7\xEB\xF1\xF4\xF9\xFE\u0102\u0107\u010D\u0110\u0118" +
            "\u011E\u0129\u012D\u012F\x02");
        });
    });
});
